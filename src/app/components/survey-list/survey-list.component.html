<!--<div class="container mx-auto p-4">-->
<!--    <p-card>-->
<!--        <ng-template pTemplate="header">-->
<!--            <div class="flex justify-between items-center">-->
<!--                <span class="text-xl font-semibold">Survey List</span>-->
<!--                <button pButton type="button" label="Create New" icon="pi pi-plus" class="p-button-success p-button-sm"-->
<!--                        routerLink="/survey"></button>-->
<!--            </div>-->
<!--        </ng-template>-->

<!--        <p-table [value]="surveys" [paginator]="true" [rows]="10" [loading]="loading" class="mt-4">-->
<!--            <ng-template pTemplate="header">-->
<!--                <tr>-->
<!--                    <th>Title</th>-->
<!--                    <th>Description</th>-->
<!--                    <th>Location Based</th>-->
<!--                    <th>Image Required</th>-->
<!--                    <th>Active</th>-->
<!--                    <th>Actions</th>-->
<!--                </tr>-->
<!--            </ng-template>-->
<!--            <ng-template pTemplate="body" let-survey>-->
<!--                <tr>-->
<!--                    <td>{{ survey.title }}</td>-->
<!--                    <td>{{ survey.description }}</td>-->
<!--                    <td>-->
<!--                        <p-tag [value]="survey.is_location_based ? 'Yes' : 'No'"-->
<!--                               severity="{{ survey.is_location_based ? 'info' : 'warning' }}"></p-tag>-->
<!--                    </td>-->
<!--                    <td>-->
<!--                        <p-tag [value]="survey.is_image_required ? 'Yes' : 'No'"-->
<!--                               severity="{{ survey.is_image_required ? 'info' : 'warning' }}"></p-tag>-->
<!--                    </td>-->
<!--                    <td>-->
<!--                        <p-tag [value]="survey.is_active ? 'Active' : 'Inactive'"-->
<!--                               severity="{{ survey.is_active ? 'success' : 'danger' }}"></p-tag>-->
<!--                    </td>-->
<!--                    <td>-->
<!--                        <button pButton type="button" icon="pi pi-eye" class="p-button-text text-blue-600"-->
<!--                                (click)="toggleDetails(survey)"></button>-->
<!--                        <button pButton type="button" icon="pi pi-pencil" class="p-button-text text-yellow-600"-->
<!--                                (click)="toggleEdit(survey)"></button>-->

<!--                        <button pButton type="button" icon="pi pi-trash" class="p-button-text text-red-600"-->
<!--                                (click)="confirmDelete(survey.id)"></button>-->
<!--                    </td>-->
<!--                </tr>-->
<!--            </ng-template>-->
<!--        </p-table>-->
<!--    </p-card>-->

<!--    <p-confirmDialog header="Confirm Delete" icon="pi pi-exclamation-triangle"></p-confirmDialog>-->
<!--</div>-->


<div class="container mx-auto p-4">
    <p-card>
        <ng-template pTemplate="header">
            <div class="flex justify-between items-center">
                <span class="text-xl font-semibold">Survey List</span>
                <button pButton type="button" label="Create New" icon="pi pi-plus" class="p-button-success p-button-sm"
                        routerLink="/survey"></button>
            </div>
        </ng-template>

        <p-table [value]="surveys" [paginator]="true" [rows]="10" [loading]="loading" class="mt-4">
            <ng-template pTemplate="header">
                <tr>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Location Based</th>
                    <th>Image Required</th>
                    <th>Active</th>
                    <th>Actions</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-survey>
                <tr>
                    <td>{{ survey.title }}</td>
                    <td>{{ survey.description }}</td>
                    <td>
                        <p-tag [value]="survey.is_location_based ? 'Yes' : 'No'"
                               severity="{{ survey.is_location_based ? 'info' : 'warning' }}"></p-tag>
                    </td>
                    <td>
                        <p-tag [value]="survey.is_image_required ? 'Yes' : 'No'"
                               severity="{{ survey.is_image_required ? 'info' : 'warning' }}"></p-tag>
                    </td>
                    <td>
                        <p-tag [value]="survey.is_active ? 'Active' : 'Inactive'"
                               severity="{{ survey.is_active ? 'success' : 'danger' }}"></p-tag>
                    </td>
                    <td>
                        <button pButton type="button" icon="pi pi-eye" class="p-button-text text-blue-600"
                                (click)="toggleDetails(survey)"></button>
                        <button pButton type="button" icon="pi pi-pencil" class="p-button-text text-yellow-600"
                                (click)="toggleEdit(survey)"></button>
                        <button pButton type="button" icon="pi pi-trash" class="p-button-text text-red-600"
                                (click)="confirmDelete(survey.id)"></button>
                    </td>
                </tr>

                <!-- Details view -->
                <tr *ngIf="expandedSurvey?.id === survey.id && !editMode">
                    <td colspan="6">
                        <div class="bg-gray-50 p-4 rounded-md space-y-2">
                            <h4 class="text-lg font-semibold">Survey Details</h4>
                            <p><strong>Created At:</strong> {{ survey.created_at | date:'short' }}</p>
                            <p><strong>Department:</strong> {{ survey.department }}</p>
                            <p><strong>Site ID:</strong> {{ survey.site_id }}</p>
                            <p><strong>Questions:</strong></p>
                            <ul class="list-disc pl-6">
                                <li *ngFor="let q of survey.questions">{{ q.text }} ({{ q.type }})</li>
                            </ul>
                            <p><strong>Targets:</strong></p>
                            <ul class="list-disc pl-6">
                                <li *ngFor="let t of survey.targets">{{ t.target_type }} -
                                    {{ t.role_name || t.department || t.site_id || t.user_id }}</li>
                            </ul>
                        </div>
                    </td>
                </tr>

                <!-- Edit form -->
                <tr *ngIf="expandedSurvey?.id === survey.id && editMode">
                    <td colspan="6">
                        <div class="bg-yellow-50 p-4 rounded-md space-y-2">
                            <h4 class="text-lg font-semibold">Edit Survey</h4>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label>Title</label>
                                    <input pInputText [(ngModel)]="expandedSurvey.title" class="w-full" />
                                </div>
                                <div>
                                    <label>Description</label>
                                    <textarea pInputTextarea [(ngModel)]="expandedSurvey.description" rows="2" class="w-full"></textarea>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                                <p-checkbox label="Location Based" [(ngModel)]="expandedSurvey.is_location_based"></p-checkbox>
                                <p-checkbox label="Image Required" [(ngModel)]="expandedSurvey.is_image_required"></p-checkbox>
                                <p-checkbox label="Active" [(ngModel)]="expandedSurvey.is_active"></p-checkbox>
                            </div>

                            <div class="flex justify-end gap-2 mt-4">
                                <button pButton label="Cancel" class="p-button-secondary" (click)="cancelEdit()"></button>
                                <button pButton label="Save" icon="pi pi-check" (click)="saveSurvey(expandedSurvey)"></button>
                            </div>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </p-card>

    <p-confirmDialog header="Confirm Delete" icon="pi pi-exclamation-triangle"></p-confirmDialog>
</div>
